cmake_minimum_required(VERSION 3.13)
project(World)

# --- Find CommonAPI packages ---
find_package(CommonAPI REQUIRED)
find_package(CommonAPI-SomeIP REQUIRED)
find_package(vsomeip3 REQUIRED)

# --- Boost ---
find_package(Boost 1.54 COMPONENTS system thread log REQUIRED)

set(PRJ_NAME World)
set(CMAKE_VERBOSE_MAKEFILE ON)

# --- Project options and settings ---
option(USE_FILE "Set to OFF to disable file logging" OFF)
option(USE_CONSOLE "Set to OFF to disable console logging" OFF)
set(MAX_LOG_LEVEL "DEBUG" CACHE STRING "maximum log level")

add_definitions(-DCOMMONAPI_LOGLEVEL=COMMONAPI_LOGLEVEL_${MAX_LOG_LEVEL})
if(USE_FILE)
  add_definitions(-DUSE_FILE)
endif()
if(USE_CONSOLE)
  add_definitions(-DUSE_CONSOLE)
endif()

# --- Source Files ---
set(PRJ_SRC_PATH src/v0)
set(PRJ_SRC_GEN_PATH src-gen)
set(PRJ_SRC_GEN_COMMONAPI_PATH ${PRJ_SRC_GEN_PATH}/core/v0/commonapi/examples)
set(PRJ_SRC_GEN_COMMONAPI_SOMEIP_PATH ${PRJ_SRC_GEN_PATH}/someip/v0/commonapi/examples)

set(PRJ_NAME_CLIENT ${PRJ_NAME}Client)
set(PRJ_NAME_SERVICE ${PRJ_NAME}Service)

# Application
FILE(GLOB PRJ_PROXY_GEN_SRCS ${PRJ_SRC_GEN_COMMONAPI_PATH}/*Proxy.cpp)
FILE(GLOB PRJ_STUB_GEN_SRCS ${PRJ_SRC_GEN_COMMONAPI_PATH}/*Stub*.cpp)
FILE(GLOB PRJ_STUB_IMPL_SRCS ${PRJ_SRC_PATH}/*Stub*.cpp)
set(PRJ_CLIENT_SRCS ${PRJ_SRC_PATH}/${PRJ_NAME_CLIENT}.cpp ${PRJ_PROXY_GEN_SRCS})
set(PRJ_SERVICE_SRCS ${PRJ_SRC_PATH}/${PRJ_NAME_SERVICE}.cpp ${PRJ_SRC_PATH}/${PRJ_NAME}StubImpl.cpp ${PRJ_STUB_GEN_SRCS} ${PRJ_STUB_IMPL_SRCS})

# SOME/IP library
FILE(GLOB PRJ_SOMEIP_LIB_SRCS ${PRJ_SRC_GEN_COMMONAPI_SOMEIP_PATH}/*.cpp)

# --- Build Targets ---
add_executable(${PRJ_NAME_CLIENT} ${PRJ_CLIENT_SRCS})
add_executable(${PRJ_NAME_SERVICE} ${PRJ_SERVICE_SRCS})
add_library(${PRJ_NAME}-someip SHARED ${PRJ_SOMEIP_LIB_SRCS})

# --- Link Libraries ---
target_link_libraries(${PRJ_NAME_CLIENT} CommonAPI CommonAPI-SomeIP vsomeip3 ${Boost_LIBRARIES})
target_link_libraries(${PRJ_NAME_SERVICE} CommonAPI CommonAPI-SomeIP vsomeip3 ${Boost_LIBRARIES})
target_link_libraries(${PRJ_NAME}-someip CommonAPI-SomeIP vsomeip3 ${Boost_LIBRARIES})

# --- Include directories for generated code ---
target_include_directories(${PRJ_NAME_CLIENT} PRIVATE src-gen/core src-gen/someip)
target_include_directories(${PRJ_NAME_SERVICE} PRIVATE src-gen/core src-gen/someip)
target_include_directories(${PRJ_NAME}-someip PRIVATE src-gen/core src-gen/someip)